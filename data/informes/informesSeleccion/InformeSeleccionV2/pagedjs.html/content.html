<script>
    (function () {
        // Trigger para chrome-pdf si tienes “wait for printing trigger”
        function done(){ window.JSREPORT_READY_TO_START = true; }

        if (!window.Paged) { setTimeout(done, 0); return; }

        // Estado del breadcrumb “actual”
        window.__currentBreadcrumb = 'Informe de Selección';

        class GMPHandler extends window.Paged.Handler {
            renderNode (node) {
                if (node && node.nodeType === 1 && node.hasAttribute('data-breadcrumb')) {
                    window.__currentBreadcrumb = node.getAttribute('data-breadcrumb') || window.__currentBreadcrumb;
                }
            }
            afterPage (page) {
                var content = page && page.element && page.element.querySelector('.pagedjs_page_content');
                if (!content) return;
                var hdr = document.createElement('div');
                hdr.className = 'page-breadcrumb';
                hdr.textContent = window.__currentBreadcrumb;
                content.insertBefore(hdr, content.firstChild);
            }
            onFragment (fragment) {  // “Continuación” cuando parte un bloque
                if (fragment && fragment.after && fragment.after.node) {
                    fragment.after.node.classList.add('continued');
                }
            }
        }

        window.Paged.registerHandlers(GMPHandler);
        document.addEventListener('pagedjs:rendered', done);
        setTimeout(done, 3000); // salvavidas
    })();
</script>

<style>
    .page-breadcrumb{ font-size:9pt; color:#39424c; margin:0 0 6mm 0; line-height:1.2; }
    .continued::before{ content:'Continuación'; display:block; color:#5d6670; font-size:9pt; margin-bottom:2mm; }
</style>
